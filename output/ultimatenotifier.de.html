<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>Ultimate Notifier Script (#) xythobuz.de</title>
    <meta name="description" content="Sending Push Notifications to an iPhone from a Bash Script" />
    <meta name="keywords" content="xythobuz" />
    <link rel="author" href="/xythobuz@xythobuz.de">
    <link rel="shortcut icon" href="/img/favicon.ico">
    <script type="text/javascript" src="/js/sh_main.js"></script>
    <link type="text/css" rel="stylesheet" href="/css/sh_bright.min.css" />
    <link rel="stylesheet" href="/css/style.css" type="text/css" media="screen" />
    <link rel="alternate" type="application/rss+xml" title="Blog" href="/rss.xml">
    <link rel="stylesheet" href="/css/gh-fork-ribbon.css" />
    <link href='http://fonts.googleapis.com/css?family=Droid+Sans:400,700' rel='stylesheet' type='text/css'>
    <script type='text/javascript'>
/* <![CDATA[ */
(function() {
var s = document.createElement('script');
var t = document.getElementsByTagName('script')[0];
s.type = 'text/javascript';
s.async = true;
s.src = '//api.flattr.com/js/0.6/load.js?mode=auto&uid=xythobuz&category=text';
t.parentNode.insertBefore(s, t);
})();
/* ]]> */
</script>
</head>
<body onload="sh_highlightDocument('/js/sh/', '.min.js');">
    
    <div id="header">
        <h1>xythobuz.de</h1>
        <p><a href="http://xythobuz.de/lastmusic">♫</a></p>
        <h2>Ultimate Notifier Script</h2>
    </div>
    <div id="lang"><span id="lang2">Translation: 
<a href='ultimatenotifier.de.html'>de</a> | <a href='ultimatenotifier.html'>en</a>
</span></div>
    <div class="colmask leftmenu"><div class="colleft">
        <div class="content">

            <h1>Ultimate Notifier Script</h1>
<p>Der Dienst <a href="http://ultimatenotifier.com/">Ultimate Notifier</a> erlaubt es relativ problemlos, zum Beispiel mittels curl Push-Notifications an ein iPhone zu senden. Darauf basierend können Shell Skripte geschrieben werden, welche regelmäßig als Cron-Job gestartet werden. So kann man sich zum Beispiel über eine geänderte Public IP informieren lassen. Dafür muss dieses Skript irgendwo gespeichert werden:</p>
<pre class="sh_sh">
#!/bin/sh

ipfile=".currentip"
service="ifconfig.me"
user="username"
pass="password"
message="IP:"

ip=`curl -s $service`
touch $ipfile
lastip=`cat $ipfile`
if [ "$ip" != "$lastip" ]; then
    echo "New public IP. Sending notification!"
    curl -s "https://www.ultimatenotifier.com/items/User/send/${user}/message=${message}%20${ip}/password=${pass}"
fi
cp /dev/null $ipfile
echo $ip > $ipfile
</pre>

<p>Es liest die aktuelle öffentliche IP mittels curl vom Dienst <a href="http://ifconfig.me">ifconfig.me</a> aus und vergleicht diese mit der zwischengespeicherten IP in einer Datei namens .currentip. Unterscheiden sich die IPs, wird eine Push Notification gesendet und die neue IP gespeichert.</p>
<p>Mit dem Befehl</p>
<pre>crontab -e</pre>

<p>Kann ein Eintrag ins cronfile hinzugefügt werden, sodass das Skript regelmäßig gestartet wird. Ein Beispiel, für 30 Minuten:</p>
<pre>*/30 * * * * /Users/anon/bin/ipnotify.sh</pre>

<p>Der Code findet sich auch auf <a href="https://github.com/xythobuz/Snippets/blob/master/ipnotify.sh">GitHub</a>.</p>
<p>Natürlich kann dieses Prinzip beliebig erweitert werden. Dieses Bash Skript wird auf meinem Server alle 5 Minuten von cron gestartet und berichtet über eventuelle Probleme.</p>
<pre class="sh_sh">
#!/bin/bash

# Checks for Health of Server and sends notifications to iPhone in case of error
# Checks for:
# - HDD Temperature
# - HDD Space
# - CPU Usage
# Sends a notification via UltimateNotifier
# Depends on bash, wget, hddtemp, grep, awk, sed, ps, sort and head.

# ------------------------------
# ------------------------------

# Your UltimateNotifier Password
UNUsername="YourUserName"
UNPassword="YourPassWord"

# Check for free space
hddMountPoint="bay" # greps for this in mounted hdds
maxPercentFull=75 # minimum percentage to send notification

# Check for CPU Usage of processes
maxCpuUsage=750 # Is in tenths of a percent (420 => 42%)

# Checks hdd temperature
# Depends on hddtemp tool
hddDevice="/dev/sda"
maxHddTemp=50

# ------------------------------
# ------------------------------

# Set $message to your Message and then call this...
function sendNotification {
  wget "https://www.ultimatenotifier.com/items/User/send/${UNUsername}/message=${message}/password=${UNPassword}" -O /dev/null -q
  echo "$message"
}

# ------------------------------
# ------------------------------

# Check for hdd temperature
hddTemp=`/usr/sbin/hddtemp ${hddDevice} | awk '{print $4}' | awk -F 'Â°' '{print $1}'`
if [ $hddTemp -gt $maxHddTemp ]; then
  message="Marvin's HDD has reached ${hddTemp}Â°C!"
  sendNotification
fi

# Check for free space on hdd
spaceUsed=`df -h | grep ${hddMountPoint} | awk '{print $5}' | sed 's/%//'`
if [ $spaceUsed -gt $maxPercentFull ]; then
  message="Marvin's HDD is ${spaceUsed}% full!"
  sendNotification
fi

# Check for most cpu intensive process, report if usage too high
processName=`ps -e -o cp,args | sed -e 's/^[ \\t]*//' | awk -F " " '{print $1, $2}' | sed -e '1d' | sort -rn | head -1 | awk '{print $2}'`
processUsage=`ps -e -o cp,args | sed -e 's/^[ \\t]*//' | awk -F " " '{print $1, $2}' | sed -e '1d' | sort -rn | head -1 | awk '{print $1}'`
if [ $processUsage -gt $maxCpuUsage ]; then
  processUsage=`echo "${processUsage} / 10.0" | bc -q`
  message="${processName} needs ${processUsage}% CPU!"
  sendNotification
fi
</pre>

            <span id="flattr">
<a class="FlattrButton" href="http://www.xythobuz.de/ultimatenotifier.de.html" title="Ultimate Notifier Script">Sending Push Notifications to an iPhone from a Bash Script</a>
</span>
<span id="twitter">
<a href="https://twitter.com/share" class="twitter-share-button" data-via="xythobuz" data-dnt="true" data-related="xythobuz" data-count="vertical">Tweet</a><script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
</span>
<span id="reddit">
<script type="text/javascript">reddit_url = "http://www.xythobuz.de/ultimatenotifier.de.html";</script>
<script type="text/javascript" src="http://www.reddit.com/static/button/button2.js"></script>
</span>

        <div id="print"><script>var pfHeaderImgUrl = '';var pfHeaderTagline = '';var pfdisableClickToDel = 0;var pfHideImages = 0;var pfImageDisplayStyle = 'right';var pfDisablePDF = 0;var pfDisableEmail = 0;var pfDisablePrint = 0;var pfCustomCSS = '';var pfBtVersion='1';(function(){var js, pf;pf = document.createElement('script');pf.type = 'text/javascript';if('https:' == document.location.protocol){js='https://pf-cdn.printfriendly.com/ssl/main.js'}else{js='http://cdn.printfriendly.com/printfriendly.js'}pf.src=js;document.getElementsByTagName('head')[0].appendChild(pf)})();</script><a href="http://www.printfriendly.com" style="color:#6D9F00;text-decoration:none;" class="printfriendly" onclick="window.print();return false;" title="Printer Friendly and PDF"><img style="border:none;margin:0 6px"  src="https://pf-cdn.printfriendly.com/images/icons/pf-print-icon.gif" width="16" height="15" alt="Print Friendly Version of this page" />Print <img style="border:none;margin:0 6px"  src="https://pf-cdn.printfriendly.com/images/icons/pf-pdf-icon.gif" width="12" height="12" alt="Get a PDF version of this webpage" />PDF</a></div>
<div id="disqus_thread"></div>
<script type="text/javascript">
var disqus_shortname = "xythobuz";
(function() {
var dsq = document.createElement("script"); dsq.type = "text/javascript"; dsq.async = true;
dsq.src = "http://" + disqus_shortname + ".disqus.com/embed.js";
(document.getElementsByTagName("head")[0] || document.getElementsByTagName("body")[0]).appendChild(dsq);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

        </div>
        <div class="nav">
            <h3>Thomas Buck</h3>

            <div id="logo"><img id="logoImg" src="http://www.gravatar.com/avatar/8d18fec40a74782052fb4c007d212475?s=180" alt="Avatar"></div>

            <p id="bio">
                I'm a 19 year old Information Engineering student from Germany, mostly building cool stuff with AVR microcontrollers. All of my projects are released as <a href="http://www.gnu.org/philosophy/free-sw.html">Free Software</a> on my <a href="https://github.com/xythobuz">GitHub Profile</a>. It would be nice if you could use this <a href="http://www.amazon.de/?_encoding=UTF8&amp;camp=1638&amp;creative=19454&amp;linkCode=ur2&amp;site-redirect=de&amp;tag=xythobuzorg-21">Amazon.de Affiliate Link</a>.
            </p>

            <ul id="menuList">
            <li><a href="/index.html">Home</a></li>
<li><a href="/blog.html">Blog</a></li>
<li><a href="/contact.html">Contact</a></li>
<li>&nbsp;</li>
<li><a href="/ledcube.html">8x8x8 LED Cube</a></li>
<li><a href="/yasab.html">YASAB AVR Bootloader</a></li>
<li><a href="/avrnetstack.html">avrNetStack</a></li>
<li><a href="/xycontrol.html">xyControl</a></li>
<li><a href="/avrserial.html">AVR Serial Library</a></li>
<li><a href="/serialdebug.html">Serial Debug</a></li>
<li><a href="/ledmatrix.html">LED Matrix</a></li>
<li><a href="/ssop28.html">SSOP28 - DIL Adapter</a></li>
<li><a href="/xyrobot.html">xyRobot</a></li>
<li><a href="/bluetooth.html">Bluetooth UART (BTM-222)</a></li>
<li><a href="/k6x4008.html">K6x4008 SRAM</a></li>
<li><a href="/xyrobotremote.html">xyRobotRemote</a></li>
<li><a href="/rremote.html">rRemote</a></li>
<li>&nbsp;</li>
<li><a href="/c250.html">Mio C250 Unlock</a></li>
<li><a href="/nas.html">IB-NAS6210 Linux</a></li>
<li><a href="/ultimatenotifier.html">Ultimate Notifier Script</a></li>
<li><a href="/serialhelper.html">Serial Helper</a></li>
            </ul>

            <div id="recent">
                Recent blog posts:
                <ul id="recentList">
                <li class="recentList"><a href="/2013_05_28_pid.html">Regelschwingungen</a></li><li class="recentDate">2013-05-28</li>
<li class="recentList"><a href="/2013_05_20_just_cause.html">Just Cause 2 Capture</a></li><li class="recentDate">2013-05-20</li>
<li class="recentList"><a href="/2013_05_17_itunes.html">Musik Script History</a></li><li class="recentDate">2013-05-17</li>
<li class="recentList"><a href="/2013_05_09_itunes.html">Musikgeschmack</a></li><li class="recentDate">2013-05-09</li>
<li class="recentList"><a href="/2013_05_05_debian.html">Debian Update</a></li><li class="recentDate">2013-05-05</li>
                </ul>
            </div>
        </div>
    </div></div>

    <img id="dude" alt="The Dude abides..." src="/img/dude.png">
    <img id="walter" alt="Mark it zero!" src="/img/walter.png">

    <div id="footer">
        Built with <a href="http://bitbucket.org/obensonne/poole">Poole</a>
        &middot;
        Licensed as <a href="http://creativecommons.org/licenses/by/3.0">CC-BY</a>
        &middot;
        <a href="http://validator.w3.org/check?uri=referer">Validate HTML</a>
        &middot;
        <a href="http://jigsaw.w3.org/css-validator/validator?uri=xythobuz.de%2Fstyle.css&amp;profile=css3">Validate CSS</a>
        &middot;
        <a href="http://feed1.w3.org/check.cgi?url=http://www.xythobuz.de/rss.xml">Validate RSS</a>
        &middot;
        <a href="http://www.validome.org/google/validate?url=http://www.xythobuz.de&amp;googleTyp=SITEMAP">Validate Sitemap</a>
    </div>
    <img src="/stats/count.php?img" alt="Analytics">
    <script src="http://gitforked.com/api/1.1/button.js" type="text/javascript"></script>
    <script type="text/javascript">
        var _gaq = _gaq || [];
        _gaq.push(['_setAccount', 'UA-39163591-1']);
        _gaq.push(['_setDomainName', 'xythobuz.org']);
        _gaq.push(['_setAllowLinker', true]);
        _gaq.push(['_trackPageview']);
        setTimeout("_gaq.push(['_trackEvent', '30_seconds', 'read'])", 30000);
        (function() {
            var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
            ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
            var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
        })();
    </script>
</body>
</html>
